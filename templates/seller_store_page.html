<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{{ seller.business_name or (seller.first_name + "'s Store") }} - Zo-Zi Marketplace</title>
    <!-- Include Socket.IO for real-time chat -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.4/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* Store Header Section */
        .store-header {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,249,250,0.98) 100%);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.3);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .store-nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .store-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .store-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #FFD700;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .default-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            border: 3px solid #FFD700;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .store-info h1 {
            color: #2c3e50;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .verified-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .verified-badge svg {
            width: 16px;
            height: 16px;
        }

        .store-tagline {
            color: #7f8c8d;
            font-size: 14px;
            font-style: italic;
        }

        .store-actions {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .share-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .contact-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .contact-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.3);
        }

        .back-btn {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(149, 165, 166, 0.3);
        }

        /* Store Hero Section */
        .store-hero {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248,249,250,0.95) 100%);
            backdrop-filter: blur(15px);
            margin: 20px;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 40px;
            align-items: center;
        }

        .hero-main h2 {
            color: #2c3e50;
            font-size: 36px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-description {
            color: #555;
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .store-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .hero-sidebar {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .seller-profile {
            text-align: center;
            margin-bottom: 20px;
        }

        .seller-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #FFD700;
            margin-bottom: 15px;
        }

        .default-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            border: 4px solid #FFD700;
            margin: 0 auto 15px;
        }

        .seller-name {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .seller-rating {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .stars {
            color: #f39c12;
            font-size: 18px;
        }

        .rating-text {
            color: #7f8c8d;
            font-size: 14px;
        }

        .seller-details {
            text-align: left;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: #555;
            font-size: 14px;
        }

        .detail-icon {
            font-size: 16px;
            width: 20px;
        }

        /* Store Categories */
        .store-categories {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .section-title {
            color: white;
            font-size: 32px;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
        }

        .section-title::after {
            content: '';
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 2px;
        }

        .category-filters {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 12px 25px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            color: #2c3e50;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .product-card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .product-card::before {
            content: '';
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
        }

        .product-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .product-card:hover .product-image {
            transform: scale(1.1);
        }

        .product-info {
            padding: 20px;
        }

        .product-name {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .product-name:hover {
            color: #667eea;
        }

        .product-price {
            font-size: 20px;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 15px;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .product-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .add-cart-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
        }

        .add-cart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
        }

        .view-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .view-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        /* Share Modal */
        .share-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .share-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .share-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .share-header h3 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .share-url {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .url-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
        }

        .copy-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
        }

        .social-share {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .social-btn {
            padding: 15px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            text-align: center;
            transition: transform 0.3s ease;
            text-decoration: none;
        }

        .social-btn:hover {
            transform: translateY(-3px);
        }

        .facebook { background: #3b5998; }
        .twitter { background: #1da1f2; }
        .whatsapp { background: #25d366; }
        .email { background: #34495e; }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }

        /* Empty State */
        .empty-store {
            text-align: center;
            padding: 80px 20px;
            color: rgba(255,255,255,0.9);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .empty-message {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .empty-submessage {
            font-size: 16px;
            opacity: 0.8;
        }

        /* Chat Widget Styles */
        .chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            font-family: Arial, sans-serif;
        }

        .chat-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 8px 25px rgba(46, 204, 113, 0.4);
            transition: all 0.3s ease;
            position: relative;
        }

        .chat-button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(46, 204, 113, 0.5);
        }

        .chat-notification {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: none;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .chat-window {
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            display: none;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.8) translateY(20px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .chat-window.show {
            display: flex;
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .chat-header .seller-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .chat-header .default-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .chat-info h3 {
            margin: 0;
            font-size: 16px;
            font-weight: bold;
        }

        .chat-info p {
            margin: 2px 0 0 0;
            font-size: 12px;
            opacity: 0.8;
        }

        .chat-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .chat-close:hover {
            opacity: 1;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .chat-message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .chat-message.received {
            align-items: flex-start;
        }

        .message-sender {
            font-size: 12px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .message-bubble {
            max-width: 70%;
            padding: 10px 14px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chat-message.received .message-bubble {
            background: white;
            border-bottom-left-radius: 4px;
        }

        .chat-message.sent .message-bubble {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-time {
            font-size: 10px;
            color: #999;
            margin-top: 5px;
        }

        .chat-input-area {
            padding: 15px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            min-height: 40px;
            max-height: 80px;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .chat-send-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: transform 0.2s ease;
        }

        .chat-send-btn:hover {
            transform: scale(1.1);
        }

        .chat-send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .chat-empty {
            text-align: center;
            padding: 30px 20px;
            color: #7f8c8d;
            font-size: 14px;
        }

        .typing-indicator {
            padding: 8px 15px;
            color: #7f8c8d;
            font-style: italic;
            font-size: 12px;
            display: none;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease-in-out;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 350px;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.error {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .toast-icon {
            font-size: 20px;
            animation: bounce 0.5s ease-in-out;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .toast-message {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .hero-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .store-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .store-nav {
                flex-direction: column;
                gap: 20px;
            }

            .store-actions {
                width: 100%;
                justify-content: center;
            }

            .store-hero {
                margin: 15px;
                padding: 25px;
            }

            .hero-main h2 {
                font-size: 28px;
            }

            .hero-description {
                font-size: 16px;
            }

            .store-stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
            }

            .category-filters {
                gap: 10px;
            }

            .filter-btn {
                padding: 10px 20px;
                font-size: 14px;
            }

            .chat-window {
                width: calc(100vw - 40px);
                height: 70vh;
                right: 20px;
                left: 20px;
            }
        }

        @media (max-width: 480px) {
            .store-hero {
                margin: 10px;
                padding: 20px;
            }

            .section-title {
                font-size: 24px;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }

            .social-share {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Store Header -->
    <header class="store-header">
        <nav class="store-nav">
            <div class="store-brand">
                {% if seller.store_logo %}
                    <img src="{{ url_for('static', filename=seller.store_logo) }}"
                         alt="{{ seller.business_name or seller.first_name }}"
                         class="store-logo"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                    <div class="default-logo" style="display: none;">
                        {{ (seller.business_name or seller.first_name or 'S')[0].upper() }}
                    </div>
                {% else %}
                    <div class="default-logo">
                        {{ (seller.business_name or seller.first_name or 'S')[0].upper() }}
                    </div>
                {% endif %}

                <div class="store-info">
                    <h1>
                        <span>{{ seller.business_name or (seller.first_name + "'s Store") }}</span>
                        {% if seller.is_verified %}
                        <span class="verified-badge">
                            <svg fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            Verified
                        </span>
                        {% endif %}
                    </h1>
                    <div class="store-tagline">Premium Quality ‚Ä¢ Fast Shipping ‚Ä¢ Great Service</div>
                </div>
            </div>

            <div class="store-actions">
    <button class="action-btn share-btn" onclick="openShareModal()">
        <span>üì§</span> Share Store
    </button>
    {% if user and not user.is_seller %}
    <button class="action-btn contact-btn" onclick="openSellerChat()">
        <span>üí¨</span> Message Seller
        <span class="message-badge" id="buyerMessageBadge" style="background: red; color: white; border-radius: 50%; padding: 2px 6px; font-size: 10px; margin-left: 5px; display: none;">0</span>
    </button>
    {% endif %}
    {% if user and user.is_seller and user.email == seller.email %}
    <button class="action-btn contact-btn" onclick="openSellerMessages()">
        üí¨ Messages <span id="sellerMessageBadge" style="background: red; color: white; border-radius: 50%; padding: 2px 8px; font-size: 12px; margin-left: 5px; display: none;">0</span>
    </button>
    {% endif %}
    <a href="{{ url_for('index') }}" class="action-btn back-btn">
        <span>‚Üê</span> Back to Zo-Zi
    </a>
</div>
        </nav>
    </header>

    <!-- Store Hero Section -->
    <section class="store-hero">
        <div class="hero-content">
            <div class="hero-main">
                <h2>Welcome to {{ seller.business_name or (seller.first_name + "'s Store") }}</h2>
                {% if user and user.email == seller.email %}
                <div style="position: relative;">
                    <button onclick="editDescription()" style="position: absolute; right: 0; top: 0; background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                        ‚úèÔ∏è Edit Description
                    </button>
                    <p class="hero-description" id="storeDescription" style="padding-right: 150px;">
                {% else %}
                    <p class="hero-description" id="storeDescription">
                {% endif %}
                        {{ seller.business_description or 'Discover amazing products carefully curated just for you. We\'re committed to providing the highest quality items with exceptional customer service. Browse our collection and find exactly what you\'re looking for!' }}
                    </p>

                <div class="store-stats">
                    <div class="stat-card">
                        <div class="stat-number">{{ seller.product_count or 0 }}</div>
                        <div class="stat-label">Products</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ seller.total_sales or 0 }}</div>
                        <div class="stat-label">Sales</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ seller.rating_count or 0 }}</div>
                        <div class="stat-label">Reviews</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ "%.1f"|format(seller.avg_rating or 0) }}</div>
                        <div class="stat-label">Rating</div>
                    </div>
                </div>
            </div>

            <div class="hero-sidebar">
                <div class="seller-profile">
                    {% if seller.profile_picture %}
                        <img src="{{ url_for('static', filename=seller.profile_picture) }}"
                             alt="{{ seller.first_name }}"
                             class="seller-avatar"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                        <div class="default-avatar" style="display: none;">
                            {{ (seller.first_name or 'S')[0].upper() }}
                        </div>
                    {% else %}
                        <div class="default-avatar">
                            {{ (seller.first_name or 'S')[0].upper() }}
                        </div>
                    {% endif %}

                    <div class="seller-name">{{ seller.first_name }} {{ seller.last_name }}</div>

                    <div class="seller-rating">
                        <div class="stars">
                            {% if seller.avg_rating and seller.avg_rating > 0 %}
                                {% for i in range(5) %}
                                    {% if i < seller.avg_rating %}‚≠ê{% else %}‚òÜ{% endif %}
                                {% endfor %}
                            {% else %}
                                ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ
                            {% endif %}
                        </div>
                        <span class="rating-text">
                            {{ "%.1f"|format(seller.avg_rating or 0) }}/5
                        </span>
                    </div>
                </div>

                <div class="seller-details">
                    <div class="detail-item">
                        <span class="detail-icon">üìç</span>
                        <span>{{ seller.business_address or seller.parish or 'Jamaica' }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-icon">üìß</span>
                        <span>{{ seller.email }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-icon">üìÖ</span>
                        <span>Member since {{ seller.join_date or '2024' }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-icon">üöö</span>
                        <span>Ships Jamaica-wide</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Store Categories & Products -->
    <section class="store-categories">
        <h2 class="section-title">üõçÔ∏è Our Products</h2>

        <div class="category-filters">
            <button class="filter-btn active" data-category="all">All Products</button>
            {% if product_categories %}
                {% for category in product_categories %}
                    <button class="filter-btn" data-category="{{ category }}">{{ category }}</button>
                {% endfor %}
            {% endif %}
        </div>

        {% if products %}
            <div class="products-grid" id="productsGrid">
                {% for product in products %}
                    <div class="product-card" data-category="{{ product.category or 'uncategorized' }}">
                        <img src="{{ url_for('static', filename=product.image_url) }}"
                             alt="{{ product.name }}"
                             class="product-image"
                             onclick="window.location.href='{{ url_for('product', product_key=product.product_key|replace(' ', '+')) }}'"
                             onerror="this.src='{{ url_for('static', filename='product-placeholder.svg') }}'">

                        <div class="product-info">
                            <div class="product-name"
                                 onclick="window.location.href='{{ url_for('product', product_key=product.product_key|replace(' ', '+')) }}'">
                                {{ product.name }}
                            </div>
                            <div class="product-price">${{ product.price }} JMD</div>

                            <div class="product-actions">
                                <button class="product-btn add-cart-btn"
                                        onclick="addToCart('{{ product.product_key|replace('\'', '\\\'') }}', {{ product.price }}, '{{ product.image_url }}')">
                                    üõí Add to Cart
                                </button>
                                <button class="product-btn view-btn"
                                        onclick="window.location.href='{{ url_for('product', product_key=product.product_key|replace(' ', '+')) }}'">
                                    üëÅÔ∏è View
                                </button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-store">
                <div class="empty-icon">üè™</div>
                <div class="empty-message">Store Coming Soon!</div>
                <div class="empty-submessage">This seller is setting up their amazing products. Check back soon!</div>
            </div>
        {% endif %}
    </section>

    <!-- Share Modal -->
    <div class="share-modal" id="shareModal">
        <div class="share-content">
            <button class="close-modal" onclick="closeShareModal()">√ó</button>

            <div class="share-header">
                <h3>üì§ Share This Store</h3>
                <p>Spread the word about {{ seller.business_name or (seller.first_name + "'s Store") }}!</p>
            </div>

            <div class="share-url">
                <input type="text" class="url-input" id="storeUrl" readonly>
                <button class="copy-btn" onclick="copyStoreUrl()">üìã Copy</button>
            </div>

            <div class="social-share">
                <a href="#" class="social-btn facebook" id="facebookShare" target="_blank">
                    üìò Facebook
                </a>
                <a href="#" class="social-btn twitter" id="twitterShare" target="_blank">
                    üê¶ Twitter
                </a>
                <a href="#" class="social-btn whatsapp" id="whatsappShare" target="_blank">
                    üí¨ WhatsApp
                </a>
                <a href="#" class="social-btn email" id="emailShare">
                    üìß Email
                </a>
            </div>
        </div>
    </div>

    <!-- Include message widget -->
    <style>
        /* Hide the message icon only for buyers (they have the button), show it for sellers */
        {% if user and not user.is_seller %}
        .message-icon-wrapper {
            display: none !important;
        }
        {% endif %}
    </style>
    {% if user %}
    {% include 'message_widget.html' %}
    {% endif %}

    <script>
        // Store URL for sharing
        const storeUrl = window.location.href;
        const storeName = {{ (seller.business_name or (seller.first_name + "'s Store")) | tojson }};
        const buyerEmail = {{ (user.email if user else "anonymous") | tojson }};
        const sellerEmail = {{ seller.email | tojson }};

        // Initialize share modal
        function initializeShareModal() {
            document.getElementById('storeUrl').value = storeUrl;
            const shareText = `Check out ${storeName} on Zo-Zi! Amazing products and great service. üõçÔ∏è`;
            document.getElementById('facebookShare').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(storeUrl)}`;
            document.getElementById('twitterShare').href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(storeUrl)}`;
            document.getElementById('whatsappShare').href = `https://wa.me/?text=${encodeURIComponent(shareText + ' ' + storeUrl)}`;
            document.getElementById('emailShare').href = `mailto:?subject=${encodeURIComponent('Check out ' + storeName + ' on Zo-Zi!')}&body=${encodeURIComponent(shareText + '\n\n' + storeUrl)}`;
        }

        // Open/close share modal
        function openShareModal() {
            document.getElementById('shareModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeShareModal() {
            document.getElementById('shareModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Copy store URL
        async function copyStoreUrl() {
            const urlInput = document.getElementById('storeUrl');
            try {
                await navigator.clipboard.writeText(urlInput.value);
                showToast('üìã Copied!', 'Store URL copied to clipboard');
            } catch (err) {
                urlInput.select();
                document.execCommand('copy');
                showToast('üìã Copied!', 'Store URL copied to clipboard');
            }
        }

        // Edit store description
function editDescription() {
    const descriptionElement = document.getElementById('storeDescription');
    const currentText = descriptionElement.innerText;
    const editHTML = `
        <textarea id="editDescriptionText" style="width: 100%; min-height: 150px; padding: 10px; border: 2px solid #667eea; border-radius: 8px; font-size: 16px; font-family: inherit; resize: vertical;">${currentText}</textarea>
        <div style="margin-top: 10px;">
            <button onclick="saveDescription()" style="background: #2ecc71; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">üíæ Save</button>
            <button onclick="cancelEdit()" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">‚úñ Cancel</button>
        </div>
    `;
    // Replace the parent div (position: relative) with the edit form
    const parentDiv = descriptionElement.parentElement;
    parentDiv.innerHTML = editHTML;

    // Focus on textarea
    document.getElementById('editDescriptionText').focus();
}

async function saveDescription() {
    const newDescription = document.getElementById('editDescriptionText').value;

    if (!newDescription.trim()) {
        showToast('Error', 'Description cannot be empty', 'error');
        return;
    }

    try {
        const response = await fetch('/seller/update_description', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken()
            },
            body: JSON.stringify({ description: newDescription })
        });

        // Check if the response is ok
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        // Try to parse JSON
        let data;
        try {
            data = await response.json();
        } catch (jsonError) {
            console.error('JSON parse error:', jsonError);
            throw new Error('Invalid response format');
        }

        if (data.success) {
            showToast('Success', 'Description updated successfully', 'success');
            // Restore the interface with updated description
            restoreDescriptionInterface(newDescription);
        } else {
            showToast('Error', data.message || 'Failed to save description', 'error');
        }
    } catch (error) {
        console.error('Save description error:', error);
        showToast('Error', `Failed to save description: ${error.message}`, 'error');
    }
}

function restoreDescriptionInterface(updatedDescription) {
    const isOwner = {{ (user.email if user else "") | tojson }} === sellerEmail && {{ (user.is_seller if user else false) | tojson }} === true;

    // Find the description's parent element and update only the description part
    const descContainer = document.querySelector('#storeDescription')?.parentElement ||
                          document.querySelector('.hero-description')?.parentElement;

    if (!descContainer) {
        console.error('Could not find description container');
        location.reload(); // Fallback: reload page to show updated description
        return;
    }

    if (isOwner) {
        descContainer.innerHTML = `
            <button onclick="editDescription()" style="position: absolute; right: 0; top: 0; background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                ‚úèÔ∏è Edit Description
            </button>
            <p class="hero-description" id="storeDescription" style="padding-right: 150px;">
                ${updatedDescription}
            </p>
        `;
    } else {
        descContainer.innerHTML = `
            <p class="hero-description" id="storeDescription">
                ${updatedDescription}
            </p>
        `;
    }
}

function cancelEdit() {
    const originalDescription = {{ (seller.business_description or "Discover amazing products carefully curated just for you. We're committed to providing the highest quality items with exceptional customer service. Browse our collection and find exactly what you're looking for!") | tojson }};
    restoreDescriptionInterface(originalDescription);
}

// Seller messaging functions
function openSellerMessages() {
    window.location.href = '/seller/messages';
}

// Open chat with seller from store page
function openSellerChat() {
    console.log('openSellerChat called');

    const sellerEmail = {{ seller.email | tojson }};
    const sellerName = {{ (seller.business_name or seller.first_name) | tojson }};

    console.log('Seller info:', sellerEmail, sellerName);

    // Check if user is logged in
    const buyerEmail = {{ (user.email if user else "anonymous") | tojson }};
    if (buyerEmail === 'anonymous') {
        alert('Please login to message the seller');
        window.location.href = {{ url_for("login") | tojson }};
        return;
    }

    // Use the global startChatWith function from message_widget
    if (window.startChatWith && typeof window.startChatWith === 'function') {
        console.log('Calling startChatWith...');
        window.startChatWith(sellerEmail, sellerName);
    } else {
        console.error('startChatWith function not available');
        console.log('window.startChatWith:', window.startChatWith);
        alert('Messaging system not loaded. Please refresh the page and try again.');
    }
}

// Check for new messages for sellers
async function checkSellerMessages() {
    // Only check if the current user owns this store
    if ({{ (user.email if user else "") | tojson }} === sellerEmail && {{ (user.is_seller if user else false) | tojson }} === true) {
        try {
            const response = await fetch('/api/unread_messages_count');
            const data = await response.json();
            const badge = document.getElementById('sellerMessageBadge');
            if (badge) {
                if (data.count > 0) {
                    badge.textContent = data.count;
                    badge.style.display = 'inline';
                } else {
                    badge.style.display = 'none';
                }
            }
        } catch (error) {
            console.error('Error checking seller messages:', error);
        }
    }
}

function showToast(title, message, type = 'success') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icon = type === 'success' ? '‚úÖ' : '‚ùå';
            toast.innerHTML = `
                <div class="toast-icon">${icon}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function getCSRFToken() {
            return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
        }

        // Category filtering
        function initializeFilters() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            const productCards = document.querySelectorAll('.product-card');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const category = btn.dataset.category;
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    productCards.forEach(card => {
                        if (category === 'all' || card.dataset.category === category) {
                            card.style.display = 'block';
                            card.style.animation = 'fadeIn 0.5s ease';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            });
        }

        // Add to cart
        async function addToCart(productKey, price, imageUrl) {
            try {
                const response = await fetch('/cart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify({
                        product_key: productKey,
                        quantity: 1,
                        price: price,
                        image_url: imageUrl
                    })
                });
                const data = await response.json();
                if (data.success) {
                    showToast('üõí Added to Cart!', 'Product successfully added to your cart');
                } else {
                    showToast('‚ùå Error', data.message || 'Failed to add product to cart', 'error');
                }
            } catch (error) {
                console.error('Add to cart error:', error);
                showToast('‚ùå Error', 'Unable to add product to cart', 'error');
            }
        }

        // Initialize
document.addEventListener('DOMContentLoaded', () => {
    initializeShareModal();
    initializeFilters();
    initializeSocket();

    // Check for seller messages only if current user owns this store
    const currentUserEmail = {{ (user.email if user else "") | tojson }};
    const isCurrentUserSeller = {{ (user.is_seller if user else false) | tojson }} === true;

    if (currentUserEmail === sellerEmail && isCurrentUserSeller) {
        checkSellerMessages();
        setInterval(checkSellerMessages, 30000); // Check every 30 seconds
    }

    document.body.style.opacity = '0';
    setTimeout(() => {
        document.body.style.transition = 'opacity 0.5s ease';
        document.body.style.opacity = '1';
    }, 100);
});

document.addEventListener('click', (e) => {
    const shareModal = document.getElementById('shareModal');
    if (e.target === shareModal) {
        closeShareModal();
    }
});

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeShareModal();
    }
});
    </script>
</body>
</html>